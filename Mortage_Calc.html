<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Personalized Mortgage Calculator | PHINMA Properties</title>
<link rel="stylesheet" href="Mortage_Calc.css" />

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>

<body>

    <div class="email-container">
        <div class="header">
            <div class="logo">PHINMA PROPERTIES</div>
            <h1>Your Personalized Mortgage Calculator</h1>
            <p>Calculate your investment in Solano Hillside Residences</p>
        </div>
        
        <div class="content">
            <div class="intro">
                <h2>Hello! üëã</h2>
                <p>Thank you for your interest in Solano Hillside Residences. Use this interactive calculator to see how affordable your dream home can be. Adjust the sliders to customize based on your budget.</p>
            </div>
            
            <div class="calculator-section">
                <h3 class="section-title">Customize Your Investment</h3>
                
                <div class="input-group">
                    <div class="input-row">
                        <div class="input-label">Property Price</div>
                        <div class="input-controls">
                            <span style="font-weight: 600; color: #cfa85b;">‚Ç±</span>
                            <input type="number" id="propertyPrice" class="number-input" value="3868900" min="1000000" max="10000000" step="10000">
                            <input type="range" id="propertyPriceSlider" class="slider" min="1000000" max="10000000" step="10000" value="3868900">
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-label">Your Downpayment</div>
                        <div class="input-controls">
                            <input type="number" id="downpaymentPercent" class="number-input" value="10" min="0" max="100" step="1">
                            <span style="font-weight: 600; color: #cfa85b;">%</span>
                            <input type="range" id="downpaymentSlider" class="slider" min="0" max="100" step="1" value="10">
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-label">Loan Term</div>
                        <div class="input-controls">
                            <input type="number" id="loanTerm" class="number-input" value="25" min="5" max="30" step="1">
                            <span style="font-weight: 600; color: #cfa85b;">years</span>
                            <input type="range" id="loanTermSlider" class="slider" min="5" max="30" step="1" value="25">
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-label">Interest Rate</div>
                        <div class="input-controls">
                            <input type="number" id="interestRate" class="number-input" value="6.5" min="0" max="15" step="0.1">
                            <span style="font-weight: 600; color: #cfa85b;">%</span>
                            <input type="range" id="interestRateSlider" class="slider" min="0" max="15" step="0.1" value="6.5">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="result-section">
                <h3 class="section-title">Your Payment Plan</h3>
                
                <div class="monthly-payment">
                    <div class="payment-label">Estimated Monthly Payment</div>
                    <div class="payment-amount" id="monthlyPayment">‚Ç± 14,003</div>
                    <div style="color: #666; font-size: 14px; margin-top: 5px;">for <span id="termYears">25</span> years</div>
                </div>
                
                <div class="breakdown">
                    <div class="breakdown-item">
                        <div class="breakdown-label">Property Price</div>
                        <div class="breakdown-value" id="breakdownPrice">‚Ç± 3,868,900</div>
                    </div>
                    
                    <div class="breakdown-item">
                        <div class="breakdown-label">Your Downpayment</div>
                        <div class="breakdown-value" id="breakdownDownpayment">‚Ç± 386,890</div>
                    </div>
                    
                    <div class="breakdown-item">
                        <div class="breakdown-label">Loan Amount</div>
                        <div class="breakdown-value" id="breakdownLoan">‚Ç± 3,482,010</div>
                    </div>
                    
                    <div class="breakdown-item">
                        <div class="breakdown-label">Total Interest</div>
                        <div class="breakdown-value" id="breakdownInterest">‚Ç± 1,718,083</div>
                    </div>
                </div>
                
                <div class="schedule-preview">
                    <div class="schedule-title">First Year Payment Preview</div>
                    <table class="schedule-table" id="previewTable">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Principal</th>
                                <th>Interest</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody id="previewBody">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="cta-section">
                <h3 class="cta-title">Get Your Full Amortization Schedule</h3>
                <p style="margin-bottom: 20px; color: #666;">Enter your email to receive a detailed payment schedule and connect with our property specialist.</p>
                
                <div class="email-form">
                    <input type="email" id="clientEmail" class="email-input" placeholder="Your email address" required>
                    <input type="text" id="clientName" class="email-input" placeholder="Your name (optional)">
                    <input type="tel" id="clientPhone" class="email-input" placeholder="Your phone number (optional)">
                    <button class="btn" id="sendScheduleBtn">Submit Computation</button>
                </div>
                
                <p style="margin-top: 15px; font-size: 14px; color: #666;">Please contact us again through our contact website or visit our site to discuss your options.</p>
            </div>
            
            <div class="disclaimer">
                <strong>Important Notes:</strong> This calculator provides estimates only. Final loan amounts, interest rates, and terms are subject to bank/HDMF approval based on your financial documents. Prices and promotions are subject to change without prior notice. All computations exclude processing fees, insurance, and other charges.
            </div>
        </div>
        
        <div class="footer">
            <p>PHINMA PRISM PROPERTY DEVELOPMENT CORPORATION</p>
            <p>Solano Hillside Residences | Finca Tower</p>
            <div class="contact-info">
                <p>üìç Solano, Paranaque | üìû (078) 123-4567 | ‚úâÔ∏è info@phinmaproperties.com</p>
            </div>
        </div>
    </div>

<script>
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyAz8CoOb7k45On36GEQRcFPDxTvtdzU1ss",
  authDomain: "solanodb-a4f65.firebaseapp.com",
  projectId: "solanodb-a4f65",
  storageBucket: "solanodb-a4f65.firebasestorage.app",
  messagingSenderId: "98081894649",
  appId: "1:98081894649:web:67f3e3d0ef8d3b7a013228"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ================= EMAILJS INIT ================= */
(function () {
  emailjs.init("JOQqxoCLq72v5huex");
})();

/* ================= DOM ================= */
const propertyPriceInput = document.getElementById('propertyPrice');
const propertyPriceSlider = document.getElementById('propertyPriceSlider');
const downpaymentPercentInput = document.getElementById('downpaymentPercent');
const downpaymentSlider = document.getElementById('downpaymentSlider');
const loanTermInput = document.getElementById('loanTerm');
const loanTermSlider = document.getElementById('loanTermSlider');
const interestRateInput = document.getElementById('interestRate');
const interestRateSlider = document.getElementById('interestRateSlider');

const monthlyPaymentEl = document.getElementById('monthlyPayment');
const termYearsEl = document.getElementById('termYears');
const breakdownPriceEl = document.getElementById('breakdownPrice');
const breakdownDownpaymentEl = document.getElementById('breakdownDownpayment');
const breakdownLoanEl = document.getElementById('breakdownLoan');
const breakdownInterestEl = document.getElementById('breakdownInterest');
const previewBody = document.getElementById('previewBody');

const sendScheduleBtn = document.getElementById('sendScheduleBtn');

/* ================= HELPERS ================= */
function formatCurrency(n) {
  return '‚Ç± ' + n.toLocaleString('en-PH');
}

function formatCurrencyDecimal(n) {
  return '‚Ç± ' + n.toLocaleString('en-PH', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

/* ================= SYNC INPUTS ================= */
function setupInputSync(input, slider) {
  input.addEventListener('input', () => {
    slider.value = input.value;
    calculate();
  });

  slider.addEventListener('input', () => {
    input.value = slider.value;
    calculate();
  });
}

setupInputSync(propertyPriceInput, propertyPriceSlider);
setupInputSync(downpaymentPercentInput, downpaymentSlider);
setupInputSync(loanTermInput, loanTermSlider);
setupInputSync(interestRateInput, interestRateSlider);

/* ================= CALCULATE ================= */
function calculate() {
  const propertyPrice = +propertyPriceInput.value;
  const dpPercent = +downpaymentPercentInput.value / 100;
  const years = +loanTermInput.value;
  const rate = +interestRateInput.value / 100;

  termYearsEl.textContent = years;

  const downpayment = propertyPrice * dpPercent;
  const loanAmount = propertyPrice - downpayment;

  const r = rate / 12;
  const months = years * 12;

  const monthly = rate === 0
    ? loanAmount / months
    : loanAmount * (r * Math.pow(1 + r, months)) / (Math.pow(1 + r, months) - 1);

  const totalPayment = monthly * months;
  const totalInterest = totalPayment - loanAmount;

  monthlyPaymentEl.textContent = formatCurrencyDecimal(monthly);
  breakdownPriceEl.textContent = formatCurrency(propertyPrice);
  breakdownDownpaymentEl.textContent = formatCurrency(downpayment);
  breakdownLoanEl.textContent = formatCurrency(loanAmount);
  breakdownInterestEl.textContent = formatCurrency(totalInterest);

  generateFirstYearPreview(loanAmount, r, monthly);
}

/* ================= AMORT PREVIEW ================= */
function generateFirstYearPreview(balance, rate, monthly) {
  previewBody.innerHTML = '';

  for (let m = 1; m <= 12; m++) {
    const interest = balance * rate;
    const principal = monthly - interest;
    balance -= principal;

    previewBody.innerHTML += `
      <tr>
        <td>Month ${m}</td>
        <td>${formatCurrencyDecimal(principal)}</td>
        <td>${formatCurrencyDecimal(interest)}</td>
        <td>${formatCurrency(balance)}</td>
      </tr>
    `;
  }
}

/* ================= FIREBASE SAVE ================= */
async function saveMortgageCalculation(data) {
  return db.collection('mortgage_calculations').add({
    ...data,
    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
    source: 'mortgage_calculator',
    status: 'new'
  });
}

/* ================= CHECK EXISTING ================= */
async function checkExistingInquiry(email) {
  const snap = await db.collection('inquiries')
    .where('email', '==', email)
    .limit(1)
    .get();

  return !snap.empty;
}

/* ================= EMAIL SEND ================= */
function sendCalculationEmail_EmailJS(email, name, data) {
  const message = `
Hello ${name || "Client"},

PROPERTY PRICE: ${formatCurrency(data.propertyPrice)}
DOWNPAYMENT (${data.downpaymentPercent}%): ${formatCurrency(data.downpaymentAmount)}
LOAN AMOUNT: ${formatCurrency(data.loanAmount)}

LOAN TERM: ${data.loanTermYears} years
INTEREST RATE: ${data.interestRate}%

MONTHLY PAYMENT: ${formatCurrencyDecimal(data.monthlyPayment)}
TOTAL INTEREST: ${formatCurrency(data.totalInterest)}
TOTAL PAYMENT: ${formatCurrency(data.totalPayment)}

PHINMA Properties
Solano Hillside Residences
`;

  return emailjs.send("service_hehhqyt", "template_dc67lup", {
    to_email: email,
    client_name: name || "Client",
    message
  });
}

/* ================= SUBMIT ================= */
sendScheduleBtn.addEventListener('click', async () => {
  const email = clientEmail.value.trim();
  const name = clientName.value.trim();
  const phone = clientPhone.value.trim();

  if (!email || !email.includes('@')) {
    alert('Enter a valid email');
    return;
  }

  calculate();

  const price = +propertyPriceInput.value;
  const dpPercent = +downpaymentPercentInput.value;
  const downpayment = price * (dpPercent / 100);
  const loanAmount = price - downpayment;
  const monthly = +monthlyPaymentEl.textContent.replace(/[‚Ç±,]/g, '');
  const years = +loanTermInput.value;
  const months = years * 12;
  const totalPayment = monthly * months;
  const totalInterest = totalPayment - loanAmount;

  const isExisting = await checkExistingInquiry(email);

  const data = {
    email,
    name: name || 'Not provided',
    phone: phone || 'Not provided',
    propertyPrice: price,
    downpaymentPercent: dpPercent,
    downpaymentAmount: downpayment,
    loanAmount,
    loanTermYears: years,
    interestRate: +interestRateInput.value,
    monthlyPayment: monthly,
    totalInterest,
    totalPayment,
    isExistingClient: isExisting
  };

  await saveMortgageCalculation(data);
  await sendCalculationEmail_EmailJS(email, name, data);

  alert('Calculation sent to Project manager and emailed to you successfully!');
});

/* ================= INIT ================= */
calculate();
</script>
</body>
</html>
